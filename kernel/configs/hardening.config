# Circle OS Kernel Hardening Config Fragment
# Applied on top of device-specific defconfig.
# Format: Kconfig fragment (merged by scripts/kconfig/merge_config.sh)

# ---- Memory safety ----
CONFIG_HARDENED_USERCOPY=y
CONFIG_FORTIFY_SOURCE=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_SLAB_FREELIST_RANDOM=y
CONFIG_SHUFFLE_PAGE_ALLOCATOR=y
CONFIG_RANDOMIZE_BASE=y          # KASLR
CONFIG_RANDOMIZE_MEMORY=y

# ---- Access control ----
CONFIG_SECURITY_LOCKDOWN_LSM=y
CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y
CONFIG_LOCK_DOWN_KERNEL_FORCE_CONFIDENTIALITY=y
CONFIG_SECURITY_YAMA=y           # ptrace scope restrictions
CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y

# ---- Disable dangerous kernel interfaces ----
CONFIG_DEVMEM=n                  # no /dev/mem
CONFIG_DEVKMEM=n                 # no /dev/kmem
CONFIG_PROC_KCORE=n              # no /proc/kcore
CONFIG_HIBERNATION=n             # no hibernation (saves sensitive mem to disk)
CONFIG_KPROBES=n                 # no runtime kernel probing
CONFIG_KALLSYMS=n                # hide kernel symbols from userspace

# ---- Restrict info leaks ----
CONFIG_PANIC_ON_OOPS=y           # reboot on oops (no crash dump to user)
CONFIG_PAGE_POISONING=y          # poison freed pages
CONFIG_PAGE_POISONING_NO_SANITY=n
CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y
CONFIG_INIT_ON_FREE_DEFAULT_ON=y

# ---- Network hardening ----
CONFIG_SYN_COOKIES=y
CONFIG_TCP_CONG_ADVANCED=y
